<!-- app/food/templates/food/add_recipe.html -->
{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block head_styles %}
    {{ super() }}
    <style>
        /* add_recipe.html é¡µé¢çš„ body ç‰¹å®šèƒŒæ™¯ */
        body {
            background-image: url("{{ url_for('static', filename='images/background_logo.jpg') }}") !important; /* ç¡®ä¿ä½ çš„èƒŒæ™¯ logo å›¾ç‰‡è·¯å¾„æ­£ç¡® */
            background-repeat: repeat !important;
            background-size: 150px !important;
            background-color: #f0f2f5 !important;
            /* ä¸ºäº†è®© .add-recipe-form-wrapper å±…ä¸­ï¼Œbody å¯èƒ½éœ€è¦ flex */
            display: flex !important; /* è¦†ç›– base.html çš„ body display (å¦‚æœä¸åŒ) */
            align-items: center !important; /* å‚ç›´å±…ä¸­ wrapper */
            justify-content: center !important; /* æ°´å¹³å±…ä¸­ wrapper */
        }

        /* è¦†ç›– main å®¹å™¨çš„ paddingï¼Œè®© wrapper å®Œå…¨æ§åˆ¶å…¶å†…éƒ¨ */
        main.container-main-content {
            padding: 0 !important;
            display: flex; /* è®© wrapper èƒ½æ›´å¥½åœ°åœ¨ main å†…å±…ä¸­ */
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .add-recipe-form-wrapper {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center; /* ç¡®ä¿ publish-container å‚ç›´å±…ä¸­ */
            padding: 20px; /* wrapper çš„å†…è¾¹è· */
            box-sizing: border-box;
            /* min-height: calc(100vh - 70px - 56px); /* å¤§è‡´è®¡ç®—ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´ */
        }

        .publish-container {
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            width: 90vw;
            max-width: 1100px; /* è°ƒæ•´æœ€å¤§å®½åº¦ */
            display: flex;
            gap: 30px;
        }
        /* ... (ä¹‹å‰æä¾›çš„ add_recipe.html ä¸­ .left-panel, .right-panel ç­‰å…¶ä»–æ ·å¼) ... */
        /* ç¡®ä¿åŒ…å«æ‰€æœ‰ .left-panel, .right-panel, .image-upload-area, .btn-publish ç­‰æ ·å¼ */
        .left-panel { flex: 0 0 40%; display: flex; flex-direction: column; gap: 20px; }
        .form-group { margin-bottom: 1rem; }
        .image-upload-area { flex-grow: 1; background-color: #f8f8f8; border: 2px dashed #d9d9d9; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 15px; overflow-y: auto; position: relative; min-height: 300px; }
        .image-upload-area .placeholder-content { color: #888; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; width: 100%; height: 100%; pointer-events: none; }
        .image-upload-area.has-images .placeholder-content { display: none; }
        .image-upload-area .placeholder-content .camera-icon { font-size: 50px; margin-bottom: 15px; }
        .image-upload-area .placeholder-content .camera-icon::before { content: 'ğŸ“·'; }
        .image-upload-area .placeholder-content .upload-text { font-size: 16px; }
        .image-upload-area .image-preview-item { position: relative; width: 100%; aspect-ratio: 16 / 9; border: 1px solid #eee; border-radius: 4px; overflow: hidden; margin-top: 10px; }
        .image-upload-area .image-preview-item img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .image-upload-area .image-preview-item .delete-image-btn { position: absolute; top: 5px; right: 5px; background-color: rgba(0,0,0,0.5); color: white; border: none; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; line-height: 20px; text-align: center; cursor: pointer; opacity: 0.8; }
        .image-upload-area .image-preview-item .delete-image-btn:hover { opacity: 1; background-color: rgba(255,0,0,0.7); }
        .action-buttons { display: flex; margin-top: auto; }
        .btn-publish { background-color: #ff9933; color: white; border-color: #ff9933; flex-grow: 1; padding: 10px 20px; font-size: 16px; border-radius: 6px; font-weight: 500; cursor: pointer; }
        .btn-publish:hover { background-color: #e68a2e; }
        .right-panel { flex: 1; display: flex; flex-direction: column; gap: 20px; min-height: 0; overflow-y: auto; padding-right: 15px; }
        .title-input, .form-select.title-input, .description-input { width: 100%; padding: 12px; border: 1px solid #d9d9d9; border-radius: 4px; font-size: 14px; box-sizing: border-box; background-color: #fdfdfd; color: #555; }
        .title-input { font-size: 18px; font-weight: bold; min-height: 40px; }
        .description-input { min-height: 150px; flex-grow: 1; resize: vertical; }
        .title-input::placeholder, .description-input::placeholder { color: #aaa; }
        .form-control.is-invalid, .form-select.is-invalid { border-color: #dc3545 !important; }
        .invalid-feedback-container .invalid-feedback { display: block; width: 100%; margin-top: .25rem; font-size: .875em; color: #dc3545; }
    </style>
{% endblock head_styles %}

{% block app_content %}
    <div class="add-recipe-form-wrapper">
        <form method="POST" enctype="multipart/form-data" style="width: auto;">
            {{ form.hidden_tag() }}
            <div class="publish-container">
                <!-- ... (left-panel å’Œ right-panel çš„ HTML ç»“æ„ä¸ä¸Šä¸€æ¡å›å¤ç›¸åŒ) ... -->
                <div class="left-panel">
                    <div class="form-group">
                        {{ form.image_file.label(class="form-label") }}
                        {{ form.image_file(class="form-control" + (" is-invalid" if form.image_file.errors else ""), id="file-input-wtforms") }}
                        {% if form.image_file.errors %}
                            <div class="invalid-feedback-container">
                                {% for error in form.image_file.errors %}
                                    <span class="invalid-feedback">{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    <div class="image-upload-area" id="image-drop-area">
                        <div class="placeholder-content" id="placeholder">
                            <div class="camera-icon"></div>
                            <div class="upload-text">æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„æˆ–ä»ä¸Šæ–¹é€‰æ‹©æ–‡ä»¶ (é¢„è§ˆ)</div>
                        </div>
                    </div>
                    <div class="action-buttons">
                         <button type="submit" class="btn btn-publish">å‘å¸ƒé£Ÿè°±</button>
                    </div>
                </div>
                <div class="right-panel">
                    <div class="form-group">
                        {{ form.title.label(class="form-label visually-hidden") }}
                        {{ form.title(class="form-control title-input" + (" is-invalid" if form.title.errors else ""), placeholder="æ ‡é¢˜ï¼šä¾‹å¦‚ï¼Œç¾å‘³ä¾µè¢­å‘³è•¾") }}
                        {% if form.title.errors %} <div class="invalid-feedback-container"> {% for error in form.title.errors %} <span class="invalid-feedback">{{ error }}</span> {% endfor %} </div> {% endif %}
                    </div>
                    <div class="form-group">
                        {{ form.category_name.label(class="form-label") }}
                        {{ form.category_name(class="form-select title-input" + (" is-invalid" if form.category_name.errors else "")) }}
                        {% if form.category_name.errors %} <div class="invalid-feedback-container"> {% for error in form.category_name.errors %} <span class="invalid-feedback">{{ error }}</span> {% endfor %} </div> {% endif %}
                    </div>
                    <div class="form-group flex-grow-1 d-flex flex-column">
                        {{ form.content_body.label(class="form-label visually-hidden") }}
                        {{ form.content_body(class="form-control description-input flex-grow-1" + (" is-invalid" if form.content_body.errors else ""), placeholder="åˆ†äº«ä½ çš„ç¾é£Ÿå¥‡é‡....... é£Ÿæã€æ­¥éª¤ç­‰") }}
                        {% if form.content_body.errors %} <div class="invalid-feedback-container"> {% for error in form.content_body.errors %} <span class="invalid-feedback">{{ error }}</span> {% endfor %} </div> {% endif %}
                    </div>
                </div>
            </div>
        </form>
    </div>
{% endblock app_content %}

{% block body_scripts %}
    {{ super() }}
    <!-- JavaScript ä»£ç ä¸ä¸Šä¸€æ¡å›å¤ç›¸åŒ -->
    <script>
        const fileInputWTForms = document.getElementById('file-input-wtforms');
        const imageDropArea = document.getElementById('image-drop-area');
        const placeholderContent = imageDropArea.querySelector('.placeholder-content');
        if (fileInputWTForms) { fileInputWTForms.addEventListener('change', function(event) { handleFilesJS(event.target.files); }); }
        function handleFilesJS(files) { imageDropArea.querySelectorAll('.image-preview-item').forEach(item => item.remove()); if (files && files.length > 0) { imageDropArea.classList.add('has-images'); if(placeholderContent) placeholderContent.style.display = 'none'; const firstFile = files[0]; if (firstFile && firstFile.type.startsWith('image/')) { const reader = new FileReader(); reader.onload = function(e) { createImagePreviewJS(e.target.result); }
            reader.readAsDataURL(firstFile); } } else { imageDropArea.classList.remove('has-images'); if(placeholderContent) placeholderContent.style.display = 'flex'; } }
        function createImagePreviewJS(src) { const previewItem = document.createElement('div'); previewItem.classList.add('image-preview-item'); const img = document.createElement('img'); img.src = src; img.alt = "ç¾é£Ÿé¢„è§ˆå›¾"; const deleteBtn = document.createElement('button'); deleteBtn.classList.add('delete-image-btn'); deleteBtn.innerHTML = 'Ã—'; deleteBtn.title = "ç§»é™¤é¢„è§ˆ"; deleteBtn.addEventListener('click', function(e) { e.stopPropagation(); previewItem.remove(); if (fileInputWTForms) { fileInputWTForms.value = null; } if (imageDropArea.querySelectorAll('.image-preview-item').length === 0) { imageDropArea.classList.remove('has-images'); if(placeholderContent) placeholderContent.style.display = 'flex'; } }); previewItem.appendChild(img); previewItem.appendChild(deleteBtn); imageDropArea.appendChild(previewItem); }
        imageDropArea.addEventListener('dragover', (event) => { event.preventDefault(); imageDropArea.style.borderColor = '#1890ff'; });
        imageDropArea.addEventListener('dragleave', () => { imageDropArea.style.borderColor = '#d9d9d9'; });
        imageDropArea.addEventListener('drop', (event) => { event.preventDefault(); imageDropArea.style.borderColor = '#d9d9d9'; const files = event.dataTransfer.files; if (files && files.length > 0 && fileInputWTForms) { fileInputWTForms.files = files; const changeEvent = new Event('change', { bubbles: true }); fileInputWTForms.dispatchEvent(changeEvent); } });
        if (fileInputWTForms && fileInputWTForms.files && fileInputWTForms.files.length > 0) { handleFilesJS(fileInputWTForms.files); } else if (imageDropArea.querySelectorAll('.image-preview-item').length === 0) { if(placeholderContent) placeholderContent.style.display = 'flex'; }
    </script>
{% endblock body_scripts %}